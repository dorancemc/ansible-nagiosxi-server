---
# tasks file for ansible-nagiosxi-server

- name: Disable SELinux
  selinux:
    state: disabled

- name: fetch latest stable release
  get_url:
    url: http://assets.nagios.com/downloads/nagiosxi/xi-latest.tar.gz
    dest: /tmp
  tags:
    - nagiosxi.install
    - nagiosxi.upgrade

- name: extact latest release
  unarchive:
    src: /tmp/xi-latest.tar.gz
    dest: /tmp
    copy: no
    creates: /tmp/nagiosxi
  tags:
    - nagiosxi.install
    - nagiosxi.upgrade

- name: Check the nagios exists
  stat:
    path: /etc/pki/rpm-gpg/RPM-GPG-KEY-NAGIOS
  register: stat_result
  tags:
    - nagiosxi.install
    - nagiosxi.upgrade

- name: perform (non-interactive) full install
  command: ./fullinstall -n
  args:
    chdir: /tmp/nagiosxi
    creates: /etc/pki/rpm-gpg/RPM-GPG-KEY-NAGIOS
  when: not stat_result.stat.exists
  tags:
    - nagiosxi.install

- name: perform (non-interactive) full upgrade
  command: ./upgrade -n
  args:
    chdir: /tmp/nagiosxi
    creates: /etc/pki/rpm-gpg/RPM-GPG-KEY-NAGIOS
  tags:
    - nagiosxi.upgrade
